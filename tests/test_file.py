import os

from docci.config import TEST_DATA_DIR
from docci.file import extract_file_name, FileAttachment


def test_file_attachment_load_sets_name_and_has_contest() -> None:
    file_ = FileAttachment.load(__file__)

    assert file_.name == extract_file_name(__file__)
    assert file_.content


def test_file_attachment_save_creates_file_on_disk() -> None:
    file_ = FileAttachment.load(__file__)

    save_path = "delete_test_api.py"
    file_.save(save_path)

    assert os.path.exists(save_path)

    os.remove(save_path)
    assert not os.path.exists(save_path)


def test_file_attachment_creation_from_base64() -> None:
    base64_str = "0eXw8uj06Org8iDq6/734CDv7uTv6PHoDQrR4uXk5e3o/yDuIPHl8PLo9Ojq4PLlOg0KICDK7uzzIOL75ODtOg0KICAgIF/y5fHyX87OziAiz9DO0MXSxc3YzSINCiAgyuXsIOL75ODtOg0KICAgINLl8fLu4vvpINPWIMfAziAiysDL08PAIMDR0tDAyyINCiAgxOXp8fLi6PLl6+XtIPEgMjMg4O/w5ev/IDIwMTkg4y4gMTE6NDk6NDUgVVRDIO/uIDIzIODv8OXr/yAyMDIwIOMuIDExOjQ5OjQ1IFVUQw0KwuXw8ej/OiAzICgweDIpDQrR5fDo6e376SDt7uzl8DogMDEgRDQgRjkgQ0EgQUIgM0QgQzggOTAgMDAgMDAgMDAgMTEgMDMgNDEgMDAgMDINCsjn5ODy5ev8IPHl8PLo9Ojq4PLgOiBPR1JOPTEwMjQwMDE0MzQwNDksIElOTj0wMDQwMjkwMTc5ODEsIFNUUkVFVD0i7+XwLiDS5fDl7ejt8ero6Swg5C4gNiIsIEU9Y2FAYXN0cmFsbmFsb2cucnUsIEw9yuDr8+PgLCBTPTQwIMrg6/Pm8erg/yDu4evg8fL8LCBDPVJVLCBPPSLHwM4gIiLKwMvTw8AgwNHS0MDLIiIiLCBDTj0i0uXx8u7i++kg09Ygx8DOICIiysDL08PAIMDR0tDAyyIiIg0K0fDu6iDk5enx8uLo/zoNCiAgxOXp8fLi6PLl6+XtIPE6IDIzIODv8OXr/yAyMDE5IOMuIDExOjQ5OjQ1IFVUQw0KICDE5enx8uLo8uXr5e0g7+46IDIzIODv8OXr/yAyMDIwIOMuIDExOjQ5OjQ1IFVUQw0Kwuvg5OXr5fYg8eXw8uj06Org8uA6IFNOSUxTPTE3NDEwMDU5MjMzLCBPR1JOPTExODc3NDY4MTk3NTQsIElOTj0wMDk2MDc0MTk4NDAsIFNUUkVFVD0wLCBHPc3o6ujy4CDM4Orx6Ozu4uj3LCBTTj3L5enh7uLo9ywgTD3M7vHq4uAsIFM9Nzcg4y4gzO7x6uLgLCBDPVJVLCBUPcPl7eXw4Ov87fvpIOTo8OXq8u7wLCBPPSJf8uXx8l/Ozs4gIiLP0M7QxdLFzdjNIiIiLCBDTj0iX/Ll8fJfzs7OICIiz9DO0MXSxc3YzSIiIg0KzvLq8Pvy++kg6uv+9zoNCiAgwOvj7vDo8uwg7vLq8Pvy7uPuIOrr/vfgOg0KICAgICAgzeDn4uDt6OU6IMPO0dIg0CAzNC4xMC0yMDEyLzUxMg0KICAgICAgyOTl7fLo9Ojq4PLu8DogMS4yLjY0My43LjEuMS4xLjENCiAgICAgIM/g8ODs5fLw+zogMzAgMTMgMDYgMDcgMkEgODUgMDMgMDIgMDIgMjMgMDEgMDYgMDggMkEgODUgMDMgMDcgMDEgMDEgMDIgMDINCiAgx+3g9+Xt6OU6IDA0NDAgQ0I0OSBFRUJCIDY2RTAgQjMwRSBEQkNBIDIxMEQgMkE0RiBGQkE1IDE5MTAgQzc3RiA5NDRCIDdBQUQgOUM4MSA5RTA2IEIwODggNTUzMiBENkVCIEVCMDUgRjRFNiA0MERDIDE1MjQgMTA2QyBDREU5IEQxQTggMTkxQiBENEY0IDFFOUQgRDY3QiAwOUM5IDMxN0YgRkRBMiA4QTNDDQrQ4PH46PDl7ej/IPHl8PLo9Ojq4PLgIFguNTA5Og0KICAxLiDQ4PH46PDl7ejlIDIuNS4yOS4xNSAo6vDo8uj35fHq7uUpDQogICAgzeDn4uDt6OU6IEtleSBVc2FnZQ0KICAgIMft4Pfl7ejlOiDW6PTw7uLg/yDv7uTv6PH8LCDN5e7y8OXq4OXs7vHy/Cwg2Oj08O7i4O3o5SDq6/735eksINjo9PDu4uDt6OUg5ODt7fv1IChmMCkNCiAgMi4g0ODx+Ojw5e3o5SAxLjIuODQwLjExMzU0OS4xLjkuMTUNCiAgICDN4Ofi4O3o5TogU01JTUUgQ2FwYWJpbGl0aWVzDQogICAgx+3g9+Xt6OU6IFsxXcLu5+zu5u3u8fLoIFNNSU1FIMjk5e3y6PTo6uDy7vAg7uH65ery4D0xLjIuNjQzLjIuMi4yMQ0KICAzLiDQ4PH46PDl7ejlIDIuNS4yOS4zNw0KICAgIM3g5+Lg7ejlOiBFbmhhbmNlZCBLZXkgVXNhZ2UNCiAgICDH7eD35e3o5TogIENsaWVudCBBdXRoZW50aWNhdGlvbiAoMS4zLjYuMS41LjUuNy4zLjIpIFNlY3VyZSBFbWFpbCAoMS4zLjYuMS41LjUuNy4zLjQpDQogIDQuINDg8fjo8OXt6OUgMi41LjI5LjMyDQogICAgzeDn4uDt6OU6IENlcnRpZmljYXRlIFBvbGljaWVzDQogICAgx+3g9+Xt6OU6IFsxXc/u6+jy6OrgIPHl8PLo9Ojq4PLgOiDI5OXt8uj06Org8u7wIO/u6+jy6OroPcrr4PHxIPHw5eTx8uLgIN3PIEtDMSBbMl3P7uvo8ujq4CDx5fDy6PTo6uDy4DogyOTl7fLo9Ojq4PLu8CDv7uvo8ujq6D3K6+Dx8SDx8OXk8fLi4CDdzyBLQzINCiAgNS4g0ODx+Ojw5e3o5SAxLjIuNjQzLjEwMC4xMTENCiAgICDN4Ofi4O3o5Tog0fDl5PHy4u4g/evl6vLw7u3t7ukg7+7k7+jx6CDi6+Dk5ev89uANCiAgICDH7eD35e3o5Tog0fDl5PHy4u4g/evl6vLw7u3t7ukg7+7k7+jx6Dog0crHyCAiVmlQTmV0IENTUCIsIOLl8PHo/yA0LjINCiAgNi4g0ODx+Ojw5e3o5SAyLjUuMjkuMTQNCiAgICDN4Ofi4O3o5TogU3ViamVjdCBLZXkgSWRlbnRpZmllcg0KICAgIMft4Pfl7ejlOiAxRiAyMSA0QyA3QSBBOCAxMyBEQiBFMyA1NyBEMCAyRSA3MCA2MSAzMCA1MCBDNCBFMCBBMiA3QyA0Rg0KICA3LiDQ4PH46PDl7ejlIDIuNS4yOS4xOSAo6vDo8uj35fHq7uUpDQogICAgzeDn4uDt6OU6IEJhc2ljIENvbnN0cmFpbnRzDQogICAgx+3g9+Xt6OU6INLo7yDx8+H65ery4D3K7u3l9+376SDx8+H65eryIM7j8ODt6Pfl7ejlIO3gIOTr6O3zIO/z8ug9zvLx8/Lx8uLz5fINCiAgOC4g0ODx+Ojw5e3o5SAxLjIuNjQzLjEwMC4xMTINCiAgICDN4Ofi4O3o5Tog0fDl5PHy4u4g/evl6vLw7u3t7ukg7+7k7+jx6CDo5+Tg8uXr/w0KICAgIMft4Pfl7ejlOiDR8OXk8fLi7iD96+Xq8vDu7e3u6SDv7uTv6PHoOiBWSVBORVQg0fDl5PHy4u4g09Y6IFZJUE5FVCDH4Orr/vfl7ejlIO3gIPHw5eTx8uLuIN3POiAxIMfg6uv+9+Xt6OUg7eAg8fDl5PHy4u4g09Y6IDENCiAgOS4g0ODx+Ojw5e3o5SAxLjMuNi4xLjUuNS43LjEuMQ0KICAgIM3g5+Lg7ejlOiBBdXRob3JpdHkgSW5mb3JtYXRpb24gQWNjZXNzDQogICAgx+3g9+Xt6OU6IFsxXcTu8fLz7yDqIPHi5eTl7ej/7CD25e3y8OAg8eXw8uj06Org9ujoIMzl8u7kIOTu8fLz7+A9z+7x8uDi+ejqIPbl7fLw4CDx5fDy6PTo6uD26OggKDEuMy42LjEuNS41LjcuNDguMikgxO7v7uvt6PLl6/zt7uUg6Oz/OiBVUkw9aHR0cDovL3JlZ3NlcnZpY2Uua2V5ZGlzay5ydS90ZXN0Y2Evcm9vdC90ZXN0Y2EzLmNydA0KICAxMC4g0ODx+Ojw5e3o5SAyLjUuMjkuMzENCiAgICDN4Ofi4O3o5TogQ1JMIERpc3RyaWJ1dGlvbiBQb2ludHMNCiAgICDH7eD35e3o5TogWzFd0u736uAg8ODx7/Dl5OXr5e3o/yDx7+jx6uAg7vLn++LgIChDUkwpIMjs/yDy7vfq6CDw4PHv8O7x8vDg7eXt6P86IM/u6+3u5SDo7P86IFVSTD1odHRwOi8vcmVnc2VydmljZS5rZXlkaXNrLnJ1L3Rlc3RjYS9jcmwvdGVzdGNhMy5jcmwNCiAgMTEuINDg8fjo8OXt6OUgMi41LjI5LjM1DQogICAgzeDn4uDt6OU6IEF1dGhvcml0eSBLZXkgSWRlbnRpZmllcg0KICAgIMft4Pfl7ejlOiDI5OXt8uj06Org8u7wIOrr/vfgPUFCIENCIDcwIEZCIDZEIEZEIDA4IEUxIERGIEEwIEIyIEI0IDI3IDlFIEFBIDQyIEJEIEIzIEIxIDk5IM/u8fLg4vno6iDx5fDy6PTo6uDy4DogwOTw5fEg6uDy4Ovu4+A6IE9HUk49MTAyNDAwMTQzNDA0OSwgSU5OPTAwNDAyOTAxNzk4MSwgU1RSRUVUPSLv5fAuINLl8OXt6O3x6ujpLCDkLiA2IiwgRT1jYUBhc3RyYWxuYWxvZy5ydSwgTD3K4Ovz4+AsIFM9NDAgyuDr8+bx6uD/IO7h6+Dx8vwsIEM9UlUsIE89IsfAziAiIsrAy9PDwCDA0dLQwMsiIiIsIENOPSLS5fHy7uL76SDT1iDHwM4gIiLKwMvTw8AgwNHS0MDLIiIiINHl8Ojp7fvpIO3u7OXwIPHl8PLo9Ojq4PLgPTAxIEQ0IDI4IDkzIDk4IDc2IDRCIEEwIDAwIDAwIDAwIDBGIDAzIDQxIDAwIDAyDQrP7uTv6PH8INPk7vHy7uLl8P/++eXj7iD25e3y8OA6DQogIMDr4+7w6PLsIO/u5O/o8eg6DQogICAgICDN4Ofi4O3o5Togw87R0iDQIDM0LjEwLzM0LjExLTIwMTIvNTEyDQogICAgICDI5OXt8uj06Org8u7wOiAxLjIuNjQzLjcuMS4xLjMuMg0KICAgICAgz+Dw4Ozl8vD7OiAwNSAwMA0KICDH7eD35e3o5TogQzc1QiBBMDU1IEJCRDkgNEYyNCA1OTYwIEVFNjIgODU0OSAyQUVFIEUwNTEgODExQiAwNDg3IDI5MkUgMTM5RCBCNkM3IDY0QjIgRkQ3MyA1NDVEIDBDMzIgMTlBMyA1MTIyIDgyMkMgMDVGNyA0RDA0IDc1NTggNEY2OCBFOUM3IDZDRjQgODNCOSA1QkU5IEQxMzMgMzU3MiA0QTEx"
    file_ = FileAttachment.load_from_base64(base64_str, "text.txt")
    expected_file = FileAttachment.load(os.path.join(TEST_DATA_DIR, "text.txt"))
    assert file_ == expected_file
